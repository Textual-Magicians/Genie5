<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="GenieClient.Views.MainWindow"
        Title="Genie 5"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="#1a1a2e">

    <Window.Styles>
        <Style Selector="TextBox.CommandInput">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="Foreground" Value="#e0e0e0"/>
            <Setter Property="BorderBrush" Value="#0f3460"/>
            <Setter Property="FontFamily" Value="Cascadia Mono, Consolas, monospace"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,*,Auto,Auto,Auto,Auto">
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#16213e">
            <MenuItem Header="_File">
                <MenuItem Header="_Connect..." Click="OnConnect"/>
                <MenuItem Header="_Disconnect" Click="OnDisconnect"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="OnExit"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Preferences..."/>
            </MenuItem>
            <MenuItem Header="_Scripts">
                <MenuItem Header="_Script Manager..."/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About Genie 5"/>
            </MenuItem>
        </Menu>

        <!-- Game Text Output -->
        <Border Grid.Row="1" Margin="8,8,8,4" CornerRadius="8" ClipToBounds="True">
            <ScrollViewer x:Name="OutputScroller" 
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <SelectableTextBlock x:Name="GameOutput"
                                     Background="#0d1117"
                                     Foreground="#c9d1d9"
                                     FontFamily="Cascadia Mono, Consolas, monospace"
                                     FontSize="13"
                                     Padding="12"
                                     TextWrapping="Wrap"
                                     Text="Welcome to Genie 5 - Cross-Platform Edition&#x0a;&#x0a;Use File → Connect to connect to a game server.&#x0a;"/>
            </ScrollViewer>
        </Border>

        <!-- Command Input -->
        <Border Grid.Row="2" Margin="8,4,8,4" CornerRadius="8" ClipToBounds="True">
            <TextBox x:Name="CommandInput" 
                     Classes="CommandInput"
                     Watermark="Enter command..."
                     KeyDown="OnCommandKeyDown"/>
        </Border>

        <!-- Row 1: RT | Compass | Status Effects | Left Hand | Right Hand | Prepared Spell -->
        <Border Grid.Row="3" Margin="8,4,8,2" Background="#16213e" CornerRadius="8" Padding="8,6">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <!-- Roundtime with progress bar background -->
                <Border Background="#2a2a3e" CornerRadius="6" 
                        VerticalAlignment="Center" Width="70" Height="32" ClipToBounds="True">
                    <Grid>
                        <!-- Progress bar background (fills from left based on RT) -->
                        <Border x:Name="RoundtimeBar" Background="#7f1d1d" 
                                CornerRadius="6" HorizontalAlignment="Left" Width="0"/>
                        <!-- Text overlay -->
                        <StackPanel Orientation="Horizontal" Spacing="4" 
                                    HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="RT" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                            <TextBlock x:Name="RoundtimeText" Text="0" 
                                       FontSize="14" FontWeight="Bold" Foreground="#ef4444"
                                       VerticalAlignment="Center" MinWidth="16" TextAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Compass - compact horizontal layout -->
                <Border Background="#2a2a3e" CornerRadius="6" 
                        Padding="6,4" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <!-- Cardinal directions grid -->
                        <Grid Width="44" Height="32">
                            <!-- Row 1: NW N NE -->
                            <TextBlock x:Name="CompassNW" Text="↖" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Left" VerticalAlignment="Top"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="nw"/>
                            <TextBlock x:Name="CompassN" Text="↑" FontSize="12" Foreground="#444"
                                       HorizontalAlignment="Center" VerticalAlignment="Top"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="n"/>
                            <TextBlock x:Name="CompassNE" Text="↗" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Right" VerticalAlignment="Top"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="ne"/>
                            <!-- Row 2: W O E -->
                            <TextBlock x:Name="CompassW" Text="←" FontSize="12" Foreground="#444"
                                       HorizontalAlignment="Left" VerticalAlignment="Center"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="w"/>
                            <TextBlock x:Name="CompassOut" Text="○" FontSize="9" Foreground="#444"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="out"/>
                            <TextBlock x:Name="CompassE" Text="→" FontSize="12" Foreground="#444"
                                       HorizontalAlignment="Right" VerticalAlignment="Center"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="e"/>
                            <!-- Row 3: SW S SE -->
                            <TextBlock x:Name="CompassSW" Text="↙" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Left" VerticalAlignment="Bottom"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="sw"/>
                            <TextBlock x:Name="CompassS" Text="↓" FontSize="12" Foreground="#444"
                                       HorizontalAlignment="Center" VerticalAlignment="Bottom"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="s"/>
                            <TextBlock x:Name="CompassSE" Text="↘" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="se"/>
                        </Grid>
                        <!-- Vertical separator -->
                        <Border Width="1" Background="#444" Margin="2,2"/>
                        <!-- Up/Down column -->
                        <StackPanel VerticalAlignment="Center" Spacing="2">
                            <TextBlock x:Name="CompassUp" Text="▲" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Center"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="up"/>
                            <TextBlock x:Name="CompassDown" Text="▼" FontSize="10" Foreground="#444"
                                       HorizontalAlignment="Center"
                                       Cursor="Hand" PointerPressed="OnCompassClick" Tag="down"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Position Indicator (icon-based) -->
                <Border x:Name="PositionBorder" Background="#2a2a3e" CornerRadius="6" 
                        Padding="6,4" VerticalAlignment="Center" ToolTip.Tip="Standing">
                    <Canvas x:Name="PositionIcon" Width="20" Height="18">
                        <!-- Standing icon (default) - upright with legs spread -->
                        <Canvas x:Name="IconStanding" IsVisible="True">
                            <Ellipse Canvas.Left="7" Canvas.Top="0" Width="6" Height="6" Fill="#22c55e"/>
                            <Line StartPoint="10,6" EndPoint="10,12" Stroke="#22c55e" StrokeThickness="2"/>
                            <Line StartPoint="10,12" EndPoint="6,18" Stroke="#22c55e" StrokeThickness="2"/>
                            <Line StartPoint="10,12" EndPoint="14,18" Stroke="#22c55e" StrokeThickness="2"/>
                        </Canvas>
                        <!-- Sitting icon - facing left, legs bent forward -->
                        <Canvas x:Name="IconSitting" IsVisible="False">
                            <Ellipse Canvas.Left="7" Canvas.Top="0" Width="6" Height="6" Fill="#eab308"/>
                            <Line StartPoint="10,6" EndPoint="10,11" Stroke="#eab308" StrokeThickness="2"/>
                            <Line StartPoint="10,11" EndPoint="4,11" Stroke="#eab308" StrokeThickness="2"/>
                            <Line StartPoint="4,11" EndPoint="4,18" Stroke="#eab308" StrokeThickness="2"/>
                        </Canvas>
                        <!-- Kneeling icon - on knees, legs folded under, profile view facing left -->
                        <Canvas x:Name="IconKneeling" IsVisible="False">
                            <!-- Head -->
                            <Ellipse Canvas.Left="7" Canvas.Top="0" Width="6" Height="6" Fill="#f97316"/>
                            <!-- Torso (slightly angled forward) -->
                            <Line StartPoint="10,6" EndPoint="11,12" Stroke="#f97316" StrokeThickness="2"/>
                            <!-- Thigh going back (to the left) -->
                            <Line StartPoint="11,12" EndPoint="6,14" Stroke="#f97316" StrokeThickness="2"/>
                            <!-- Lower leg folded under (going back from knee) -->
                            <Line StartPoint="6,14" EndPoint="12,16" Stroke="#f97316" StrokeThickness="2"/>
                        </Canvas>
                        <!-- Prone icon - lying down, head on right -->
                        <Canvas x:Name="IconProne" IsVisible="False">
                            <Ellipse Canvas.Left="15" Canvas.Top="7" Width="5" Height="5" Fill="#ef4444"/>
                            <Line StartPoint="15,10" EndPoint="8,10" Stroke="#ef4444" StrokeThickness="2"/>
                            <Line StartPoint="8,10" EndPoint="4,8" Stroke="#ef4444" StrokeThickness="2"/>
                            <Line StartPoint="8,10" EndPoint="4,12" Stroke="#ef4444" StrokeThickness="2"/>
                        </Canvas>
                    </Canvas>
                </Border>

                <!-- Status Effects (icon-based) -->
                <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <!-- Hidden: Eye with slash -->
                    <Border x:Name="StatusHidden" Background="#4a4a5e" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Hidden">
                        <Canvas Width="16" Height="12">
                            <Ellipse Canvas.Left="3" Canvas.Top="2" Width="10" Height="8" 
                                     Stroke="#a0a0a0" StrokeThickness="1.5" Fill="Transparent"/>
                            <Ellipse Canvas.Left="6" Canvas.Top="4" Width="4" Height="4" Fill="#a0a0a0"/>
                            <Line StartPoint="2,10" EndPoint="14,2" Stroke="#a0a0a0" StrokeThickness="2"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Invisible: Ghost -->
                    <Border x:Name="StatusInvisible" Background="#4a4a5e" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Invisible">
                        <Canvas Width="14" Height="14">
                            <Path Data="M7,1 C10,1 12,3 12,6 L12,11 L10,9 L8,11 L6,9 L4,11 L2,9 L2,6 C2,3 4,1 7,1 Z" 
                                  Stroke="#a0a0a0" StrokeThickness="1.5" Fill="Transparent" StrokeDashArray="2,1"/>
                            <Ellipse Canvas.Left="4" Canvas.Top="4" Width="2" Height="2" Fill="#a0a0a0"/>
                            <Ellipse Canvas.Left="8" Canvas.Top="4" Width="2" Height="2" Fill="#a0a0a0"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Joined: Two people/link -->
                    <Border x:Name="StatusJoined" Background="#3b5e3b" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Joined">
                        <Canvas Width="18" Height="12">
                            <!-- Person 1 -->
                            <Ellipse Canvas.Left="2" Canvas.Top="0" Width="4" Height="4" Fill="#90c090"/>
                            <Line StartPoint="4,4" EndPoint="4,9" Stroke="#90c090" StrokeThickness="1.5"/>
                            <!-- Person 2 -->
                            <Ellipse Canvas.Left="12" Canvas.Top="0" Width="4" Height="4" Fill="#90c090"/>
                            <Line StartPoint="14,4" EndPoint="14,9" Stroke="#90c090" StrokeThickness="1.5"/>
                            <!-- Link -->
                            <Line StartPoint="5,6" EndPoint="13,6" Stroke="#90c090" StrokeThickness="1.5"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Webbed: Spider web -->
                    <Border x:Name="StatusWebbed" Background="#5e4a3b" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Webbed">
                        <Canvas Width="14" Height="14">
                            <Line StartPoint="7,0" EndPoint="7,14" Stroke="#c0a080" StrokeThickness="1"/>
                            <Line StartPoint="0,7" EndPoint="14,7" Stroke="#c0a080" StrokeThickness="1"/>
                            <Line StartPoint="2,2" EndPoint="12,12" Stroke="#c0a080" StrokeThickness="1"/>
                            <Line StartPoint="12,2" EndPoint="2,12" Stroke="#c0a080" StrokeThickness="1"/>
                            <Ellipse Canvas.Left="3" Canvas.Top="3" Width="8" Height="8" 
                                     Stroke="#c0a080" StrokeThickness="1" Fill="Transparent"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Stunned: Stars/spiral -->
                    <Border x:Name="StatusStunned" Background="#5e3b3b" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Stunned">
                        <Canvas Width="16" Height="14">
                            <!-- Star 1 -->
                            <Path Canvas.Left="1" Canvas.Top="1" 
                                  Data="M4,0 L5,3 L8,3 L5.5,5 L6.5,8 L4,6 L1.5,8 L2.5,5 L0,3 L3,3 Z" 
                                  Fill="#ff8080" RenderTransform="scale(0.7)"/>
                            <!-- Star 2 -->
                            <Path Canvas.Left="8" Canvas.Top="5" 
                                  Data="M4,0 L5,3 L8,3 L5.5,5 L6.5,8 L4,6 L1.5,8 L2.5,5 L0,3 L3,3 Z" 
                                  Fill="#ff8080" RenderTransform="scale(0.6)"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Bleeding: Blood drop -->
                    <Border x:Name="StatusBleeding" Background="#5e2a2a" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Bleeding">
                        <Canvas Width="12" Height="14">
                            <Path Data="M6,0 C6,0 12,7 12,10 C12,13 9,14 6,14 C3,14 0,13 0,10 C0,7 6,0 6,0 Z" 
                                  Fill="#dc2626"/>
                        </Canvas>
                    </Border>
                    
                    <!-- Dead: Skull -->
                    <Border x:Name="StatusDead" Background="#3a1a1a" CornerRadius="4" 
                            Padding="5,4" IsVisible="False" ToolTip.Tip="Dead">
                        <Canvas Width="14" Height="14">
                            <!-- Skull shape -->
                            <Ellipse Canvas.Left="1" Canvas.Top="0" Width="12" Height="10" Fill="#ff4040"/>
                            <!-- Eyes -->
                            <Ellipse Canvas.Left="3" Canvas.Top="3" Width="3" Height="3" Fill="#3a1a1a"/>
                            <Ellipse Canvas.Left="8" Canvas.Top="3" Width="3" Height="3" Fill="#3a1a1a"/>
                            <!-- Jaw -->
                            <Rectangle Canvas.Left="4" Canvas.Top="9" Width="6" Height="5" Fill="#ff4040"/>
                            <!-- Teeth -->
                            <Line StartPoint="5,10" EndPoint="5,13" Stroke="#3a1a1a" StrokeThickness="1"/>
                            <Line StartPoint="7,10" EndPoint="7,13" Stroke="#3a1a1a" StrokeThickness="1"/>
                            <Line StartPoint="9,10" EndPoint="9,13" Stroke="#3a1a1a" StrokeThickness="1"/>
                        </Canvas>
                    </Border>
                </StackPanel>

                <!-- Left Hand -->
                <Border Background="#2a2a3e" CornerRadius="6" 
                        Padding="8,4" VerticalAlignment="Center" MinWidth="100">
                    <StackPanel>
                        <TextBlock Text="Left" FontSize="9" Foreground="#666"/>
                        <TextBlock x:Name="LeftHandText" Text="Empty" FontSize="11" Foreground="#a0a0a0"/>
                    </StackPanel>
                </Border>

                <!-- Right Hand -->
                <Border Background="#2a2a3e" CornerRadius="6" 
                        Padding="8,4" VerticalAlignment="Center" MinWidth="100">
                    <StackPanel>
                        <TextBlock Text="Right" FontSize="9" Foreground="#666"/>
                        <TextBlock x:Name="RightHandText" Text="Empty" FontSize="11" Foreground="#a0a0a0"/>
                    </StackPanel>
                </Border>

                <!-- Prepared Spell -->
                <Border Background="#2a2a3e" CornerRadius="6" 
                        Padding="8,4" VerticalAlignment="Center" MinWidth="120">
                    <StackPanel>
                        <TextBlock Text="Spell" FontSize="9" Foreground="#666"/>
                        <TextBlock x:Name="PreparedSpellText" Text="None" FontSize="11" Foreground="#a855f7"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- Row 2: Health | Mana | Concentration | Stamina | Spirit -->
        <Border Grid.Row="4" Margin="8,2,8,4" Background="#16213e" CornerRadius="8" Padding="12,8">
            <Grid ColumnDefinitions="*,*,*,*,*">
                <!-- Health Bar - Red -->
                <StackPanel Grid.Column="0" Spacing="2" Margin="0,0,8,0">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Text="Health" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" x:Name="HealthText" Text="100%" 
                                   Foreground="#ef4444" FontSize="10" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="16">
                        <Border Background="#2a2a3e" CornerRadius="3"/>
                        <Border x:Name="HealthBar" Background="#ef4444" 
                                CornerRadius="3" HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>

                <!-- Mana Bar - Blue -->
                <StackPanel Grid.Column="1" Spacing="2" Margin="8,0">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Text="Mana" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" x:Name="ManaText" Text="100%" 
                                   Foreground="#3b82f6" FontSize="10" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="16">
                        <Border Background="#2a2a3e" CornerRadius="3"/>
                        <Border x:Name="ManaBar" Background="#3b82f6" 
                                CornerRadius="3" HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>

                <!-- Concentration Bar - Cyan -->
                <StackPanel Grid.Column="2" Spacing="2" Margin="8,0">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Text="Conc" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" x:Name="ConcentrationText" Text="100%" 
                                   Foreground="#22d3ee" FontSize="10" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="16">
                        <Border Background="#2a2a3e" CornerRadius="3"/>
                        <Border x:Name="ConcentrationBar" Background="#22d3ee" 
                                CornerRadius="3" HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>

                <!-- Stamina Bar - Green -->
                <StackPanel Grid.Column="3" Spacing="2" Margin="8,0">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Text="Stamina" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" x:Name="StaminaText" Text="100%" 
                                   Foreground="#22c55e" FontSize="10" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="16">
                        <Border Background="#2a2a3e" CornerRadius="3"/>
                        <Border x:Name="StaminaBar" Background="#22c55e" 
                                CornerRadius="3" HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>

                <!-- Spirit Bar - Magenta -->
                <StackPanel Grid.Column="4" Spacing="2" Margin="8,0,0,0">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Text="Spirit" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" x:Name="SpiritText" Text="100%" 
                                   Foreground="#e879f9" FontSize="10" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="16">
                        <Border Background="#2a2a3e" CornerRadius="3"/>
                        <Border x:Name="SpiritBar" Background="#e879f9" 
                                CornerRadius="3" HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="5" Background="#16213e" Padding="8,4">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <TextBlock x:Name="StatusText" Text="Disconnected" 
                           Foreground="#888" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" x:Name="ConnectionStatus" 
                           Text="●" Foreground="#ef4444" FontSize="12" 
                           VerticalAlignment="Center" Margin="8,0"/>
                <TextBlock Grid.Column="2" Text="Genie 5.0.0" 
                           Foreground="#666" VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
